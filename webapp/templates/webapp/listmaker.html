{% extends "webapp/base.html" %}

{% block title %}ListMaker Dashboard{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="text-center">ListMaker Dashboard</h1>

    <!-- Form for Adding Items -->
    <div class="card mb-4">
        <div class="card-header">Add New Item</div>
        <div class="card-body">
            <form action="{% url 'add_item' %}" method="POST">
                {% csrf_token %}
                <label>Name</label>
                <input type="text" name="name">
                
                <label>Description</label>
                <input type="text" name="description">
                
                <button type="submit">Add Item</button>
            </form>   
        </div>
    </div>

    <!-- DataTable for Viewing the List -->
    <div class="card">
        <div class="card-header">List of Items</div>
        <div class="card-body">
            <table id="listTable" class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Votes Needed</th>
                        <th>Votes Had</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be dynamically populated -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("add-item-form");

    form.addEventListener("submit", function (e) {
        e.preventDefault();

        const name = document.getElementById("name").value.trim();
        const description = document.getElementById("description").value.trim();

        if (!name || !description) {
            alert("Both Title and Description are required!");
            return;
        }

        fetch("/add-item/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCSRFToken(),
            },
            body: JSON.stringify({
                name: name,
                description: description,
            }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    alert("Item added successfully!");
                    form.reset();
                } else {
                    alert("Error: " + data.error);
                }
            })
            .catch((error) => console.error("Error adding item:", error));
    });

    // Function to get CSRF token
    function getCSRFToken() {
        return document.querySelector("[name=csrfmiddlewaretoken]").value;
    }
});



</script>
{% endblock %}